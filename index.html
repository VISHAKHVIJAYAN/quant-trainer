<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quant Aptitude Trainer</title>
    <!-- Self-contained - no external dependencies -->
    <style>
        /* Modern CSS Variables */
        :root {
            --primary: #3a86ff;
            --secondary: #8338ec;
            --success: #38b000;
            --error: #ff006e;
            --warning: #ffbe0b;
            --dark: #1a1a2e;
            --darker: #16213e;
            --card: #0f3460;
            --light: #e6e6e6;
            --gray: #8a8a8e;
            --radius: 12px;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s ease;
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, var(--darker), var(--dark));
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Header */
        header {
            text-align: center;
            padding: 25px;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--warning);
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        h1::before {
            content: 'üßÆ';
            font-size: 2.5rem;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.1);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Main Card */
        .main-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }

        .card-title {
            font-size: 1.3rem;
            margin-bottom: 25px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Difficulty Selector */
        .difficulty-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .diff-btn {
            flex: 1;
            min-width: 100px;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            text-align: center;
        }

        .diff-btn:hover {
            border-color: var(--primary);
        }

        .diff-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Controls */
        .controls {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            margin-bottom: 25px;
        }

        @media (max-width: 768px) {
            .controls {
                grid-template-columns: 1fr;
            }
        }

        select, button {
            padding: 15px;
            border-radius: var(--radius);
            border: 2px solid transparent;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
        }

        select {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%233a86ff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 20px;
            padding-right: 50px;
        }

        select:focus {
            outline: none;
            border-color: var(--primary);
        }

        button {
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            white-space: nowrap;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(58, 134, 255, 0.4);
        }

        .btn-success {
            background: var(--success);
            color: white;
            border: none;
        }

        .btn-success:hover {
            background: #2f9a00;
        }

        /* Question Display */
        .question-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: var(--radius);
            padding: 40px 20px;
            margin: 30px 0;
            text-align: center;
            min-height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed rgba(255, 255, 255, 0.1);
            font-size: 1.8rem;
        }

        /* Math Styling */
        .math {
            display: inline-block;
            margin: 0 5px;
        }

        sup, sub {
            font-size: 0.7em;
            line-height: 1;
        }

        .sqrt {
            position: relative;
            display: inline-block;
            padding-left: 5px;
        }

        .sqrt::before {
            content: '‚àö';
            position: relative;
            font-size: 1.2em;
        }

        .radicand {
            border-top: 2px solid currentColor;
            padding: 0 3px;
            display: inline-block;
        }

        .frac {
            display: inline-block;
            vertical-align: middle;
            text-align: center;
        }

        .frac > span {
            display: block;
            padding: 0 5px;
        }

        .frac > .num {
            border-bottom: 1px solid currentColor;
        }

        /* Input Area */
        .input-area {
            margin: 25px 0;
        }

        input[type="text"] {
            width: 100%;
            padding: 18px;
            font-size: 1.3rem;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: var(--light);
            border-radius: var(--radius);
            transition: var(--transition);
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.15);
        }

        .hint {
            display: block;
            text-align: center;
            margin-top: 10px;
            color: var(--gray);
            font-size: 0.9rem;
            font-style: italic;
        }

        /* Solution Area */
        .solution-area {
            background: rgba(0, 0, 0, 0.3);
            border-radius: var(--radius);
            padding: 25px;
            margin-top: 25px;
            display: none;
            border-left: 5px solid var(--primary);
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .solution-correct {
            border-left-color: var(--success);
        }

        .solution-incorrect {
            border-left-color: var(--error);
        }

        .solution-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .solution-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .steps {
            background: rgba(0, 0, 0, 0.2);
            border-radius: calc(var(--radius) - 4px);
            padding: 20px;
            margin-top: 20px;
        }

        .step {
            margin-bottom: 12px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .step:last-child {
            border-bottom: none;
        }

        .answer-display {
            background: rgba(56, 176, 0, 0.1);
            border-left: 4px solid var(--success);
            padding: 15px;
            border-radius: calc(var(--radius) - 4px);
            margin: 20px 0;
            display: none;
        }

        .answer-display.incorrect {
            background: rgba(255, 0, 110, 0.1);
            border-left-color: var(--error);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 20px;
            color: var(--gray);
            font-size: 0.9rem;
            margin-top: 30px;
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.8rem;
                flex-direction: column;
                gap: 5px;
            }
            
            .question-display {
                padding: 25px 15px;
                font-size: 1.5rem;
                min-height: 140px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .main-card {
                padding: 20px;
            }
            
            .diff-btn {
                min-width: 80px;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .difficulty-selector {
                flex-direction: column;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
        }

        /* Custom Icons */
        .icon::before {
            display: inline-block;
            margin-right: 8px;
            font-size: 1.2em;
        }

        .icon-math::before { content: 'üßÆ'; }
        .icon-star::before { content: '‚≠ê'; }
        .icon-time::before { content: '‚è±Ô∏è'; }
        .icon-check::before { content: '‚úÖ'; }
        .icon-cross::before { content: '‚ùå'; }
        .icon-light::before { content: 'üí°'; }

        /* Progress Bar */
        .progress-container {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin: 25px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Loading Animation */
        .loader {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Button Group */
        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        @media (max-width: 768px) {
            .btn-group {
                flex-direction: column;
            }
        }

        .btn-group button {
            flex: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1 class="icon-math">Quant Aptitude Trainer</h1>
            <p class="subtitle">Master quantitative aptitude with intelligent practice</p>
        </header>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="score">0</div>
                <div class="stat-label">Score</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="total">0</div>
                <div class="stat-label">Questions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="streak">0</div>
                <div class="stat-label">Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="accuracy">100%</div>
                <div class="stat-label">Accuracy</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-card">
            <div class="card-title icon-star">Settings</div>
            
            <!-- Difficulty Selector -->
            <div class="difficulty-selector">
                <div class="diff-btn active" data-level="easy" onclick="setDifficulty('easy')">
                    Easy
                </div>
                <div class="diff-btn" data-level="medium" onclick="setDifficulty('medium')">
                    Medium
                </div>
                <div class="diff-btn" data-level="hard" onclick="setDifficulty('hard')">
                    Hard
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <!-- Controls -->
            <div class="controls">
                <select id="topicSelect">
                    <option value="indices">üìà Indices & Exponents</option>
                    <option value="surds">‚àö Surds & Radicals</option>
                    <option value="logs">üìä Logarithms</option>
                    <option value="linear">üìê Linear Equations</option>
                    <option value="quadratic">üéØ Quadratic Equations</option>
                    <option value="simultaneous">‚öñÔ∏è Simultaneous Equations</option>
                    <option value="arithmetic">üßÆ Arithmetic Progression</option>
                </select>
                <button class="btn-primary" onclick="generateQuestion()">
                    New Question
                </button>
            </div>
        </div>

        <!-- Question Area -->
        <div id="questionArea" class="main-card" style="display: none;">
            <div class="card-title">Question</div>
            <div class="question-display" id="questionDisplay">
                <div class="loader"></div>
            </div>
        </div>

        <!-- Answer Input -->
        <div id="answerArea" class="main-card" style="display: none;">
            <div class="card-title">Your Answer</div>
            <div class="input-area">
                <input type="text" id="answerInput" placeholder="Enter your answer..." autocomplete="off">
                <span class="hint" id="answerHint">Press Enter to submit</span>
            </div>
            <div class="btn-group">
                <button class="btn-success" onclick="checkAnswer()">
                    Check Answer
                </button>
                <button class="btn-primary" onclick="showHint()">
                    <span class="icon-light"></span>Show Hint
                </button>
            </div>
        </div>

        <!-- Solution Area -->
        <div class="solution-area" id="solutionArea">
            <div class="solution-header">
                <div class="solution-title" id="solutionTitle">
                    Solution
                </div>
                <div id="solutionTime" class="icon-time">Time: 0s</div>
            </div>
            
            <div class="answer-display" id="answerDisplay">
                <strong>Correct Answer:</strong> <span id="correctAnswer"></span>
            </div>
            
            <div class="steps" id="solutionSteps"></div>
            
            <div class="btn-group">
                <button class="btn-primary" onclick="generateQuestion()">
                    Next Question
                </button>
                <button class="btn-success" onclick="practiceSimilar()">
                    Practice Similar
                </button>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <p>‚ö° Works offline ‚Ä¢ üéØ No external dependencies ‚Ä¢ üì± Mobile optimized</p>
        </footer>
    </div>

    <script>
        // ========== STATE MANAGEMENT ==========
        const state = {
            currentTopic: 'indices',
            difficulty: 'easy',
            currentQuestion: null,
            score: 0,
            total: 0,
            correct: 0,
            streak: 0,
            maxStreak: 0,
            startTime: null,
            hintsUsed: 0,
            questionHistory: []
        };

        // ========== DOM ELEMENTS ==========
        const elements = {
            score: document.getElementById('score'),
            total: document.getElementById('total'),
            streak: document.getElementById('streak'),
            accuracy: document.getElementById('accuracy'),
            topicSelect: document.getElementById('topicSelect'),
            questionArea: document.getElementById('questionArea'),
            questionDisplay: document.getElementById('questionDisplay'),
            answerArea: document.getElementById('answerArea'),
            answerInput: document.getElementById('answerInput'),
            answerHint: document.getElementById('answerHint'),
            solutionArea: document.getElementById('solutionArea'),
            solutionTitle: document.getElementById('solutionTitle'),
            solutionTime: document.getElementById('solutionTime'),
            solutionSteps: document.getElementById('solutionSteps'),
            answerDisplay: document.getElementById('answerDisplay'),
            correctAnswer: document.getElementById('correctAnswer'),
            progressBar: document.getElementById('progressBar')
        };

        // ========== MATH UTILITIES ==========
        const mathUtils = {
            // Random number in range [min, max]
            randomInt: (min, max) => Math.floor(Math.random() * (max - min + 1)) + min,
            
            // Random array element
            randomChoice: (arr) => arr[Math.floor(Math.random() * arr.length)],
            
            // Greatest Common Divisor
            gcd: (a, b) => b ? mathUtils.gcd(b, a % b) : Math.abs(a),
            
            // Least Common Multiple
            lcm: (a, b) => Math.abs(a * b) / mathUtils.gcd(a, b),
            
            // Perfect square check
            isPerfectSquare: (n) => {
                const sqrt = Math.floor(Math.sqrt(n));
                return sqrt * sqrt === n;
            },
            
            // Simplify fraction [numerator, denominator]
            simplifyFraction: (num, den) => {
                const gcd = mathUtils.gcd(num, den);
                return [num / gcd, den / gcd];
            },
            
            // Generate random coefficient based on difficulty
            randomCoefficient: () => {
                const ranges = {
                    easy: { min: 1, max: 5, includeNegatives: false },
                    medium: { min: -8, max: 8, includeNegatives: true },
                    hard: { min: -12, max: 12, includeNegatives: true }
                };
                const range = ranges[state.difficulty];
                let coeff = mathUtils.randomInt(range.min, range.max);
                if (!range.includeNegatives && coeff < 0) coeff = -coeff;
                if (coeff === 0) coeff = mathUtils.randomInt(1, 5);
                return coeff;
            },
            
            // Format number with sign
            formatWithSign: (num) => {
                if (num === 0) return '';
                return num > 0 ? `+ ${num}` : `- ${Math.abs(num)}`;
            }
        };

        // ========== QUESTION GENERATORS ==========
        const generators = {
            indices: () => {
                const difficulty = state.difficulty;
                let html, answer, steps = [];
                
                if (difficulty === 'easy') {
                    const base = mathUtils.randomInt(2, 5);
                    const exp1 = mathUtils.randomInt(1, 3);
                    const exp2 = mathUtils.randomInt(1, 3);
                    const operation = mathUtils.randomChoice(['√ó', '√∑']);
                    
                    if (operation === '√ó') {
                        html = `${base}<sup>${exp1}</sup> √ó ${base}<sup>${exp2}</sup>`;
                        answer = Math.pow(base, exp1 + exp2);
                        steps = [
                            `Apply the rule: a<sup>m</sup> √ó a<sup>n</sup> = a<sup>m+n</sup>`,
                            `${base}<sup>${exp1}</sup> √ó ${base}<sup>${exp2}</sup> = ${base}<sup>${exp1 + exp2}</sup>`,
                            `${base}<sup>${exp1 + exp2}</sup> = ${answer}`
                        ];
                    } else {
                        const exp3 = mathUtils.randomInt(0, exp1);
                        html = `${base}<sup>${exp1}</sup> √∑ ${base}<sup>${exp3}</sup>`;
                        answer = Math.pow(base, exp1 - exp3);
                        steps = [
                            `Apply the rule: a<sup>m</sup> √∑ a<sup>n</sup> = a<sup>m-n</sup>`,
                            `${base}<sup>${exp1}</sup> √∑ ${base}<sup>${exp3}</sup> = ${base}<sup>${exp1 - exp3}</sup>`,
                            `${base}<sup>${exp1 - exp3}</sup> = ${answer}`
                        ];
                    }
                } else if (difficulty === 'medium') {
                    const base = mathUtils.randomInt(2, 7);
                    const exp1 = mathUtils.randomInt(1, 4);
                    const exp2 = mathUtils.randomInt(1, 4);
                    html = `(${base}<sup>${exp1}</sup>)<sup>${exp2}</sup>`;
                    answer = Math.pow(base, exp1 * exp2);
                    steps = [
                        `Apply the rule: (a<sup>m</sup>)<sup>n</sup> = a<sup>m√ón</sup>`,
                        `(${base}<sup>${exp1}</sup>)<sup>${exp2}</sup> = ${base}<sup>${exp1}√ó${exp2}</sup>`,
                        `${base}<sup>${exp1 * exp2}</sup> = ${answer}`
                    ];
                } else { // hard
                    const bases = [mathUtils.randomInt(2, 4), mathUtils.randomInt(2, 4)];
                    const exps = [mathUtils.randomInt(2, 4), mathUtils.randomInt(2, 4)];
                    const operation = mathUtils.randomChoice(['√ó', '√∑']);
                    
                    if (bases[0] === bases[1]) {
                        if (operation === '√ó') {
                            html = `${bases[0]}<sup>${exps[0]}</sup> √ó ${bases[0]}<sup>${exps[1]}</sup>`;
                            answer = Math.pow(bases[0], exps[0] + exps[1]);
                            steps = [
                                `Same base: a<sup>m</sup> √ó a<sup>n</sup> = a<sup>m+n</sup>`,
                                `${bases[0]}<sup>${exps[0]}</sup> √ó ${bases[0]}<sup>${exps[1]}</sup> = ${bases[0]}<sup>${exps[0] + exps[1]}</sup>`,
                                `${bases[0]}<sup>${exps[0] + exps[1]}</sup> = ${answer}`
                            ];
                        } else {
                            const exp3 = mathUtils.randomInt(0, exps[0] + exps[1]);
                            html = `${bases[0]}<sup>${exps[0]}</sup> √∑ ${bases[0]}<sup>${exp3}</sup>`;
                            answer = Math.pow(bases[0], exps[0] - exp3);
                            steps = [
                                `Same base: a<sup>m</sup> √∑ a<sup>n</sup> = a<sup>m-n</sup>`,
                                `${bases[0]}<sup>${exps[0]}</sup> √∑ ${bases[0]}<sup>${exp3}</sup> = ${bases[0]}<sup>${exps[0] - exp3}</sup>`,
                                `${bases[0]}<sup>${exps[0] - exp3}</sup> = ${answer}`
                            ];
                        }
                    } else {
                        html = `${bases[0]}<sup>${exps[0]}</sup> √ó ${bases[1]}<sup>${exps[1]}</sup>`;
                        const val1 = Math.pow(bases[0], exps[0]);
                        const val2 = Math.pow(bases[1], exps[1]);
                        answer = val1 * val2;
                        steps = [
                            `Calculate each term separately:`,
                            `${bases[0]}<sup>${exps[0]}</sup> = ${val1}`,
                            `${bases[1]}<sup>${exps[1]}</sup> = ${val2}`,
                            `${val1} √ó ${val2} = ${answer}`
                        ];
                    }
                }
                
                return {
                    html,
                    answer: answer.toString(),
                    steps,
                    hint: "Enter the numerical value",
                    type: "indices"
                };
            },

            surds: () => {
                const difficulty = state.difficulty;
                let html, answer, steps = [];
                
                if (difficulty === 'easy') {
                    // Simplify surd
                    const squares = [4, 9, 16, 25, 36, 49, 64, 81, 100];
                    const square = mathUtils.randomChoice(squares);
                    const factor = mathUtils.randomInt(2, 5);
                    const num = square * factor;
                    
                    html = `Simplify ‚àö${num}`;
                    const simplified = Math.sqrt(square);
                    answer = factor === 1 ? simplified.toString() : `${simplified}‚àö${factor}`;
                    
                    steps = [
                        `Factor ${num} into perfect square and remaining:`,
                        `‚àö${num} = ‚àö(${square} √ó ${factor})`,
                        `= ‚àö${square} √ó ‚àö${factor}`,
                        `= ${simplified}‚àö${factor}`
                    ];
                } else if (difficulty === 'medium') {
                    // Rationalize denominator
                    const den = mathUtils.randomChoice([2, 3, 5, 6, 7, 8, 10, 11, 12]);
                    const num = den * mathUtils.randomInt(1, 5);
                    
                    html = `Rationalize: ${num}/‚àö${den}`;
                    answer = `${num}‚àö${den}/${den}`;
                    
                    steps = [
                        `Multiply numerator and denominator by ‚àö${den}:`,
                        `(${num} √ó ‚àö${den}) / (‚àö${den} √ó ‚àö${den})`,
                        `= ${num}‚àö${den} / ${den}`
                    ];
                } else { // hard
                    // Surd multiplication
                    const a = mathUtils.randomInt(2, 6);
                    const b = mathUtils.randomInt(2, 6);
                    const c = mathUtils.randomInt(2, 6);
                    
                    if (mathUtils.randomInt(1, 2) === 1) {
                        html = `Simplify: ‚àö${a} √ó ‚àö${b}`;
                        const product = a * b;
                        const sqrt = Math.sqrt(product);
                        if (mathUtils.isPerfectSquare(product)) {
                            answer = sqrt.toString();
                            steps = [
                                `‚àö${a} √ó ‚àö${b} = ‚àö(${a} √ó ${b})`,
                                `= ‚àö${product}`,
                                `= ${sqrt}`
                            ];
                        } else {
                            answer = `‚àö${product}`;
                            steps = [
                                `‚àö${a} √ó ‚àö${b} = ‚àö(${a} √ó ${b})`,
                                `= ‚àö${product}`
                            ];
                        }
                    } else {
                        html = `Simplify: (‚àö${a} + ‚àö${b})(‚àö${a} - ‚àö${b})`;
                        answer = (a - b).toString();
                        steps = [
                            `Apply difference of squares: (x+y)(x-y) = x¬≤ - y¬≤`,
                            `= (‚àö${a})¬≤ - (‚àö${b})¬≤`,
                            `= ${a} - ${b}`,
                            `= ${a - b}`
                        ];
                    }
                }
                
                return {
                    html,
                    answer,
                    steps,
                    hint: "Use format: a‚àöb or a/b‚àöc",
                    type: "surds"
                };
            },

            logs: () => {
                const difficulty = state.difficulty;
                let html, answer, steps = [];
                
                if (difficulty === 'easy') {
                    const base = mathUtils.randomInt(2, 5);
                    const value = Math.pow(base, mathUtils.randomInt(1, 3));
                    html = `log<sub>${base}</sub> ${value}`;
                    answer = Math.log(value) / Math.log(base);
                    steps = [
                        `log<sub>${base}</sub> ${value} = ?`,
                        `${base}<sup>x</sup> = ${value}`,
                        `${base}<sup>${Math.round(answer)}</sup> = ${value}`,
                        `Answer = ${Math.round(answer)}`
                    ];
                } else if (difficulty === 'medium') {
                    const a = mathUtils.randomInt(2, 5);
                    const b = mathUtils.randomInt(2, 5);
                    html = `log ${a} + log ${b}`;
                    answer = Math.log10(a * b).toFixed(4);
                    steps = [
                        `log a + log b = log(a √ó b)`,
                        `log ${a} + log ${b} = log(${a} √ó ${b})`,
                        `= log ${a * b}`,
                        `‚âà ${answer}`
                    ];
                } else { // hard
                    const base = mathUtils.randomInt(2, 5);
                    const power = mathUtils.randomInt(2, 4);
                    const value = Math.pow(base, power);
                    
                    if (mathUtils.randomInt(1, 2) === 1) {
                        html = `log<sub>${base}</sub> x = ${power}`;
                        answer = value.toString();
                        steps = [
                            `log<sub>${base}</sub> x = ${power}`,
                            `x = ${base}<sup>${power}</sup>`,
                            `x = ${value}`
                        ];
                    } else {
                        html = `log<sub>${base}</sub> ${value}`;
                        answer = power.toString();
                        steps = [
                            `${base}<sup>x</sup> = ${value}`,
                            `${base}<sup>${power}</sup> = ${value}`,
                            `x = ${power}`
                        ];
                    }
                }
                
                return {
                    html,
                    answer,
                    steps,
                    hint: "Enter numerical value",
                    type: "logs"
                };
            },

            linear: () => {
                const difficulty = state.difficulty;
                let html, answer, steps = [];
                
                const x = mathUtils.randomInt(-10, 10);
                let a = mathUtils.randomCoefficient();
                let b = mathUtils.randomCoefficient();
                
                // Ensure equation is interesting
                if (a === 0) a = 1;
                if (b === 0) b = mathUtils.randomInt(1, 5);
                
                const c = a * x + b;
                
                const bSign = b >= 0 ? '+' : '-';
                const bAbs = Math.abs(b);
                
                html = `Solve for x: ${a}x ${bSign} ${bAbs} = ${c}`;
                answer = x.toString();
                
                steps = [
                    `${a}x ${bSign} ${bAbs} = ${c}`,
                    `${a}x = ${c} ${b >= 0 ? '-' : '+'} ${bAbs}`,
                    `${a}x = ${c - b}`,
                    `x = ${c - b} / ${a}`,
                    `x = ${x}`
                ];
                
                return {
                    html,
                    answer,
                    steps,
                    hint: "Enter value of x",
                    type: "linear"
                };
            },

            quadratic: () => {
                const difficulty = state.difficulty;
                let html, answer, steps = [];
                
                // Generate roots
                let r1, r2;
                do {
                    r1 = mathUtils.randomInt(-8, 8);
                    r2 = mathUtils.randomInt(-8, 8);
                } while (r1 === r2); // Ensure distinct roots
                
                // For hard difficulty, sometimes make one root zero
                if (difficulty === 'hard' && mathUtils.randomInt(1, 3) === 1) {
                    r1 = 0;
                    r2 = mathUtils.randomInt(-6, 6);
                    if (r2 === 0) r2 = 1;
                }
                
                const a = 1;
                const b = -(r1 + r2);
                const c = r1 * r2;
                
                // Build equation string
                let equation = `x¬≤`;
                if (b !== 0) {
                    equation += ` ${mathUtils.formatWithSign(b)}x`;
                }
                if (c !== 0) {
                    equation += ` ${mathUtils.formatWithSign(c)}`;
                }
                equation += ` = 0`;
                
                html = `Solve: ${equation}`;
                
                // Sort roots for consistent answer format
                const roots = [r1, r2].sort((x, y) => x - y);
                answer = roots.join(', ');
                
                // Calculate discriminant
                const discriminant = b * b - 4 * a * c;
                const sqrtDiscriminant = Math.sqrt(Math.abs(discriminant));
                
                steps = [
                    `Equation: ${equation}`,
                    `a = ${a}, b = ${b}, c = ${c}`,
                    `Discriminant: D = b¬≤ - 4ac = (${b})¬≤ - 4(${a})(${c}) = ${discriminant}`
                ];
                
                if (discriminant >= 0) {
                    steps.push(
                        `x = [-b ¬± ‚àöD] / 2a`,
                        `x = [${-b} ¬± ‚àö${discriminant}] / 2`,
                        `x = [${-b} ¬± ${sqrtDiscriminant.toFixed(2)}] / 2`,
                        `x‚ÇÅ = ${r1}, x‚ÇÇ = ${r2}`
                    );
                } else {
                    steps.push(
                        `Discriminant is negative (${discriminant}), roots are complex`,
                        `Real roots don't exist for this equation`
                    );
                }
                
                return {
                    html,
                    answer,
                    steps,
                    hint: "Enter roots separated by comma (e.g., -2, 3)",
                    type: "quadratic"
                };
            },

            simultaneous: () => {
                const difficulty = state.difficulty;
                let html, answer, steps = [];
                
                // Generate solution
                const x = mathUtils.randomInt(-5, 5);
                const y = mathUtils.randomInt(-5, 5);
                
                // Generate coefficients
                const a1 = mathUtils.randomCoefficient();
                const b1 = mathUtils.randomCoefficient();
                const a2 = mathUtils.randomCoefficient();
                const b2 = mathUtils.randomCoefficient();
                
                // Calculate constants
                const c1 = a1 * x + b1 * y;
                const c2 = a2 * x + b2 * y;
                
                // Format equations properly
                const formatTerm = (coeff, variable) => {
                    if (coeff === 0) return '';
                    if (coeff === 1) return variable;
                    if (coeff === -1) return `-${variable}`;
                    return `${coeff}${variable}`;
                };
                
                const eq1 = `${formatTerm(a1, 'x')} ${b1 >= 0 ? '+' : ''} ${formatTerm(b1, 'y')} = ${c1}`.replace('  ', ' ');
                const eq2 = `${formatTerm(a2, 'x')} ${b2 >= 0 ? '+' : ''} ${formatTerm(b2, 'y')} = ${c2}`.replace('  ', ' ');
                
                html = `Solve:<br>${eq1}<br>${eq2}`;
                answer = `x=${x}, y=${y}`;
                
                steps = [
                    `Equations:`,
                    `1) ${eq1}`,
                    `2) ${eq2}`,
                    `Using elimination method:`,
                    `Multiply equation 1 by ${a2} and equation 2 by ${-a1}`,
                    `Add the equations to eliminate x`,
                    `Solve for y: y = ${y}`,
                    `Substitute into equation 1: x = ${x}`,
                    `Solution: x = ${x}, y = ${y}`
                ];
                
                return {
                    html,
                    answer,
                    steps,
                    hint: "Enter in format: x=value, y=value",
                    type: "simultaneous"
                };
            },

            arithmetic: () => {
                const difficulty = state.difficulty;
                let html, answer, steps = [];
                
                const a = mathUtils.randomInt(1, 10);
                const d = mathUtils.randomCoefficient();
                const n = mathUtils.randomInt(5, 15);
                
                const type = mathUtils.randomInt(1, 3);
                
                if (type === 1) {
                    // Find nth term
                    html = `Find term ${n} of AP: ${a}, ${a + d}, ${a + 2*d}, ...`;
                    const term = a + (n - 1) * d;
                    answer = term.toString();
                    steps = [
                        `AP formula: T‚Çô = a + (n-1)d`,
                        `a = ${a}, d = ${d}, n = ${n}`,
                        `T${n} = ${a} + (${n} - 1) √ó ${d}`,
                        `= ${a} + ${(n - 1) * d}`,
                        `= ${term}`
                    ];
                } else if (type === 2) {
                    // Find sum
                    html = `Find sum of first ${n} terms of AP: ${a}, ${a + d}, ${a + 2*d}, ...`;
                    const sum = (n / 2) * (2 * a + (n - 1) * d);
                    answer = sum.toString();
                    steps = [
                        `Sum formula: S‚Çô = n/2 √ó [2a + (n-1)d]`,
                        `n = ${n}, a = ${a}, d = ${d}`,
                        `S${n} = ${n}/2 √ó [2√ó${a} + (${n}-1)√ó${d}]`,
                        `= ${n / 2} √ó [${2 * a} + ${(n - 1) * d}]`,
                        `= ${n / 2} √ó ${2 * a + (n - 1) * d}`,
                        `= ${sum}`
                    ];
                } else {
                    // Find which term equals value
                    const termNum = mathUtils.randomInt(5, 12);
                    const value = a + (termNum - 1) * d;
                    html = `Which term of AP ${a}, ${a + d}, ${a + 2*d}, ... equals ${value}?`;
                    answer = termNum.toString();
                    steps = [
                        `T‚Çô = a + (n-1)d = ${value}`,
                        `${a} + (n-1)√ó${d} = ${value}`,
                        `(n-1)√ó${d} = ${value - a}`,
                        `n-1 = ${(value - a) / d}`,
                        `n = ${((value - a) / d) + 1}`,
                        `n = ${termNum}`
                    ];
                }
                
                return {
                    html,
                    answer,
                    steps,
                    hint: "Enter numerical value",
                    type: "arithmetic"
                };
            }
        };

        // ========== CORE FUNCTIONS ==========
        function generateQuestion() {
            // Reset display
            elements.solutionArea.style.display = 'none';
            elements.answerDisplay.style.display = 'none';
            elements.answerInput.value = '';
            
            // Show question area
            elements.questionArea.style.display = 'block';
            elements.answerArea.style.display = 'block';
            
            // Get topic and generate question
            state.currentTopic = elements.topicSelect.value;
            const generator = generators[state.currentTopic];
            
            try {
                state.currentQuestion = generator();
                state.startTime = Date.now();
                
                // Display question
                elements.questionDisplay.innerHTML = state.currentQuestion.html;
                elements.answerHint.textContent = state.currentQuestion.hint;
                
                // Focus input
                setTimeout(() => elements.answerInput.focus(), 100);
                
                // Add to history
                state.questionHistory.push({
                    topic: state.currentTopic,
                    question: state.currentQuestion.html,
                    time: new Date().toISOString()
                });
                
                // Update progress
                updateProgress();
                
            } catch (error) {
                console.error('Error generating question:', error);
                elements.questionDisplay.innerHTML = 
                    '<span style="color: var(--error)">Error generating question. Please try again.</span>';
            }
        }

        function checkAnswer() {
            if (!state.currentQuestion) return;
            
            const userAnswer = elements.answerInput.value.trim();
            if (!userAnswer) return;
            
            // Calculate time taken
            const timeTaken = Math.max(1, Math.floor((Date.now() - state.startTime) / 1000));
            elements.solutionTime.textContent = `Time: ${timeTaken}s`;
            
            // Validate answer based on question type
            let isCorrect = false;
            let correctAnswer = state.currentQuestion.answer;
            
            switch (state.currentQuestion.type) {
                case 'quadratic':
                    // Sort user's roots and compare
                    const userRoots = userAnswer.split(',').map(s => parseFloat(s.trim())).sort((a, b) => a - b);
                    const correctRoots = correctAnswer.split(',').map(s => parseFloat(s.trim())).sort((a, b) => a - b);
                    isCorrect = userRoots.length === 2 && 
                               Math.abs(userRoots[0] - correctRoots[0]) < 0.01 &&
                               Math.abs(userRoots[1] - correctRoots[1]) < 0.01;
                    break;
                    
                case 'simultaneous':
                    // Parse x=value, y=value format
                    const match = userAnswer.match(/x\s*[=:]\s*([-\d.]+)\s*[,;]\s*y\s*[=:]\s*([-\d.]+)/i);
                    if (match) {
                        const userX = parseFloat(match[1]);
                        const userY = parseFloat(match[2]);
                        const correctMatch = correctAnswer.match(/x=([-\d.]+), y=([-\d.]+)/);
                        if (correctMatch) {
                            const correctX = parseFloat(correctMatch[1]);
                            const correctY = parseFloat(correctMatch[2]);
                            isCorrect = Math.abs(userX - correctX) < 0.01 && 
                                       Math.abs(userY - correctY) < 0.01;
                        }
                    }
                    break;
                    
                case 'surds':
                    // Normalize surd format for comparison
                    const normalizeSurd = (str) => {
                        return str.toLowerCase()
                            .replace(/\s+/g, '')
                            .replace(/‚àö/g, 'sqrt')
                            .replace(/(\d+)sqrt(\d+)/g, '$1‚àö$2')
                            .replace(/sqrt(\d+)/g, '‚àö$1');
                    };
                    isCorrect = normalizeSurd(userAnswer) === normalizeSurd(correctAnswer);
                    break;
                    
                default:
                    // Numerical comparison
                    const userNum = parseFloat(userAnswer);
                    const correctNum = parseFloat(correctAnswer);
                    isCorrect = !isNaN(userNum) && Math.abs(userNum - correctNum) < 0.01;
            }
            
            // Update statistics
            state.total++;
            if (isCorrect) {
                state.correct++;
                state.streak++;
                state.score += Math.max(1, Math.floor(50 / timeTaken)); // Bonus for speed
                
                if (state.streak > state.maxStreak) {
                    state.maxStreak = state.streak;
                }
                
                // Visual feedback
                elements.answerInput.style.borderColor = 'var(--success)';
                elements.answerInput.style.boxShadow = '0 0 0 3px rgba(56, 176, 0, 0.2)';
            } else {
                state.streak = 0;
                elements.answerInput.style.borderColor = 'var(--error)';
                elements.answerInput.style.boxShadow = '0 0 0 3px rgba(255, 0, 110, 0.2)';
            }
            
            // Update UI
            updateStatistics();
            showSolution(isCorrect);
        }

        function showSolution(isCorrect) {
            // Show solution area
            elements.solutionArea.style.display = 'block';
            elements.solutionArea.className = isCorrect ? 
                'solution-area solution-correct' : 
                'solution-area solution-incorrect';
            
            // Update title
            elements.solutionTitle.innerHTML = isCorrect ? 
                '<span class="icon-check"></span> Correct!' : 
                '<span class="icon-cross"></span> Incorrect';
            
            // Show correct answer if wrong
            if (!isCorrect) {
                elements.answerDisplay.style.display = 'block';
                elements.answerDisplay.className = 'answer-display incorrect';
                elements.correctAnswer.textContent = state.currentQuestion.answer;
            }
            
            // Display steps
            if (state.currentQuestion.steps) {
                const stepsHtml = state.currentQuestion.steps
                    .map(step => `<div class="step">${step}</div>`)
                    .join('');
                elements.solutionSteps.innerHTML = stepsHtml;
            }
            
            // Scroll to solution
            elements.solutionArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function updateStatistics() {
            elements.score.textContent = state.score;
            elements.total.textContent = state.total;
            elements.streak.textContent = state.streak;
            
            const accuracy = state.total > 0 ? 
                Math.round((state.correct / state.total) * 100) : 100;
            elements.accuracy.textContent = `${accuracy}%`;
        }

        function updateProgress() {
            const progress = state.total % 10 * 10;
            elements.progressBar.style.width = `${progress}%`;
        }

        function setDifficulty(level) {
            state.difficulty = level;
            
            // Update UI
            document.querySelectorAll('.diff-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.level === level) {
                    btn.classList.add('active');
                }
            });
        }

        function showHint() {
            state.hintsUsed++;
            alert(`Hint: ${state.currentQuestion.hint}\n\nTip: ${state.currentQuestion.steps?.[0] || 'Try breaking the problem into smaller steps.'}`);
        }

        function practiceSimilar() {
            // Generate another question of same type
            generateQuestion();
        }

        // ========== EVENT LISTENERS ==========
        elements.topicSelect.addEventListener('change', generateQuestion);
        
        elements.answerInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                checkAnswer();
            }
        });
        
        elements.answerInput.addEventListener('focus', function() {
            this.style.borderColor = 'var(--primary)';
            this.style.boxShadow = '0 0 0 3px rgba(58, 134, 255, 0.2)';
        });
        
        elements.answerInput.addEventListener('blur', function() {
            if (!this.value) {
                this.style.borderColor = 'rgba(255, 255, 255, 0.2)';
                this.style.boxShadow = 'none';
            }
        });

        // ========== INITIALIZATION ==========
        function init() {
            updateStatistics();
            setDifficulty('easy');
            
            // Generate first question
            setTimeout(generateQuestion, 500);
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    elements.answerInput.value = '';
                } else if (event.ctrlKey && event.key === 'n') {
                    event.preventDefault();
                    generateQuestion();
                }
            });
            
            console.log('Quant Trainer initialized successfully!');
        }

        // Initialize on load
        window.addEventListener('load', init);
    </script>
</body>
</html>
