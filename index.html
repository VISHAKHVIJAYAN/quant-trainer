<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quant Aptitude Trainer</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --accent-color: #bb86fc;
            --success-color: #03dac6;
            --error-color: #cf6679;
            --border-radius: 8px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 600px;
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        h1 { margin: 0; font-size: 1.5rem; color: var(--accent-color); }
        
        .score-board {
            font-size: 0.9rem;
            background: #333;
            padding: 5px 10px;
            border-radius: 4px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        select, button, input {
            padding: 10px;
            border-radius: var(--border-radius);
            border: 1px solid #444;
            background: #2c2c2c;
            color: white;
            font-size: 1rem;
        }

        select { flex-grow: 1; cursor: pointer; }
        
        button {
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s;
        }

        .btn-primary { background-color: var(--accent-color); color: black; border: none; }
        .btn-primary:hover { opacity: 0.9; }
        
        .btn-check { background-color: var(--success-color); color: black; border: none; width: 100%; margin-top: 10px;}
        
        /* New utility class to replace inline style */
        .btn-next { width: 100%; margin-top: 15px; }

        .question-area {
            text-align: center;
            margin: 30px 0;
            font-size: 1.5rem;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            /* FIXED: Changed from column to row to prevent stacking */
            flex-direction: row; 
            flex-wrap: wrap;
            gap: 8px;
        }

        /* Math Formatting */
        .math-root { white-space: nowrap; }
        .math-root span { border-top: 1px solid white; padding-top: 1px; }
        sup { font-size: 0.6em; vertical-align: super; }
        sub { font-size: 0.6em; vertical-align: sub; }

        .input-group { margin-bottom: 20px; }
        
        input[type="text"] {
            width: 100%;
            box-sizing: border-box;
            text-align: center;
            font-size: 1.2rem;
        }

        .hint {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
            text-align: center;
            display: block;
        }

        .solution-area {
            background: #252526;
            padding: 15px;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--accent-color);
            margin-top: 20px;
            display: none; 
        }

        .solution-title {
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
            color: var(--accent-color);
        }

        .step { margin-bottom: 5px; font-family: monospace; }

        .status-correct { border-left-color: var(--success-color); }
        .status-wrong { border-left-color: var(--error-color); }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Quant Trainer</h1>
        <div class="score-board">Score: <span id="score">0</span> / <span id="total">0</span></div>
    </header>

    <div class="controls">
        <select id="topicSelect" aria-label="Select Math Topic">
            <option value="indices">Indices (Exponents)</option>
            <option value="surds">Surds (Roots)</option>
            <option value="logs">Logarithms</option>
            <option value="linear">Linear Equations</option>
            <option value="quadratic">Quadratic Equations</option>
        </select>
        <button class="btn-primary" onclick="generateQuestion()" id="genBtn">New Question</button>
    </div>

    <div id="gameArea" class="hidden">
        <div class="question-area" id="questionText">
            </div>

        <div class="input-group">
            <input type="text" id="userAnswer" placeholder="Enter answer..." autocomplete="off">
            <span class="hint" id="inputHint"></span>
        </div>

        <button class="btn-check" onclick="checkAnswer()" id="checkBtn">Check Answer</button>
    </div>

    <div class="solution-area" id="solutionBox">
        <span class="solution-title" id="solutionStatus">Solution</span>
        <div id="steps"></div>
        <button class="btn-primary btn-next" onclick="generateQuestion()">Next Question</button>
    </div>
</div>

<script>
    // State
    let currentTopic = '';
    let currentQuestion = {};
    let score = 0;
    let total = 0;

    // DOM Elements
    const els = {
        topic: document.getElementById('topicSelect'),
        question: document.getElementById('questionText'),
        input: document.getElementById('userAnswer'),
        hint: document.getElementById('inputHint'),
        gameArea: document.getElementById('gameArea'),
        solutionBox: document.getElementById('solutionBox'),
        status: document.getElementById('solutionStatus'),
        steps: document.getElementById('steps'),
        score: document.getElementById('score'),
        total: document.getElementById('total'),
        checkBtn: document.getElementById('checkBtn'),
        genBtn: document.getElementById('genBtn')
    };

    // Math Utils
    const rnd = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const rndItem = (arr) => arr[Math.floor(Math.random() * arr.length)];
    const gcd = (a, b) => (!b) ? a : gcd(b, a % b);

    // --- Generators ---

    const generators = {
        indices: () => {
            const type = rnd(1, 2);
            let qHtml, answer, steps = [];
            
            if (type === 1) { 
                const base = rnd(2, 5);
                const e1 = rnd(2, 6);
                const e2 = rnd(2, 6);
                const e3 = rnd(1, e1 + e2 - 1); 
                
                qHtml = `${base}<sup>${e1}</sup> × ${base}<sup>${e2}</sup> ÷ ${base}<sup>${e3}</sup>`;
                const finalExp = e1 + e2 - e3;
                answer = Math.pow(base, finalExp);
                
                steps.push(`Apply laws of indices: a<sup>m</sup> × a<sup>n</sup> = a<sup>m+n</sup>`);
                steps.push(`${base}<sup>${e1}+${e2}</sup> ÷ ${base}<sup>${e3}</sup> = ${base}<sup>${e1+e2}</sup> ÷ ${base}<sup>${e3}</sup>`);
                steps.push(`Apply division law: a<sup>m</sup> ÷ a<sup>n</sup> = a<sup>m-n</sup>`);
                steps.push(`${base}<sup>${e1+e2}-${e3}</sup> = ${base}<sup>${finalExp}</sup>`);
                steps.push(`Calculate: ${base}<sup>${finalExp}</sup> = ${answer}`);
            } else { 
                const base = rnd(2, 3);
                const e1 = rnd(2, 3);
                const e2 = rnd(2, 3);
                qHtml = `(${base}<sup>${e1}</sup>)<sup>${e2}</sup>`;
                const finalExp = e1 * e2;
                answer = Math.pow(base, finalExp);
                
                steps.push(`Apply power rule: (a<sup>m</sup>)<sup>n</sup> = a<sup>m×n</sup>`);
                steps.push(`${base}<sup>${e1}×${e2}</sup> = ${base}<sup>${finalExp}</sup>`);
                steps.push(`Calculate: ${answer}`);
            }

            return { html: qHtml, ans: answer, steps, hint: "Enter an integer" };
        },

        surds: () => {
            const type = rnd(1, 2);
            let qHtml, answer, steps = [];
            let hint = "Format: '3root2' for 3√2";

            if (type === 1) {
                const square = [4, 9, 16, 25, 36, 49, 64];
                const sq = rndItem(square);
                const rem = rndItem([2, 3, 5, 6, 7]);
                const num = sq * rem;
                const rootSq = Math.sqrt(sq);
                
                qHtml = `Simplify: √${num}`;
                answer = `${rootSq}root${rem}`;
                if (rootSq === 1) answer = `root${rem}`;
                
                steps.push(`Factorize ${num} into a square number and a remainder`);
                steps.push(`√${num} = √(${sq} × ${rem})`);
                steps.push(`Separately root the square: √${sq} = ${rootSq}`);
                steps.push(` ${rootSq}√${rem}`);
            } else {
                const den = rndItem([2, 3, 5, 6, 7]);
                const num = den * rnd(1, 5);
                const factor = num / den;
                
                qHtml = `Rationalize: ${num} / √${den}`;
                answer = (factor === 1) ? `root${den}` : `${factor}root${den}`;
                
                steps.push(`Multiply numerator and denominator by √${den}`);
                steps.push(`(${num} × √${den}) / (√${den} × √${den})`);
                steps.push(`${num}√${den} / ${den}`);
                steps.push(`Simplify fraction ${num}/${den} = ${factor}`);
                steps.push(`Result: ${factor === 1 ? '' : factor}√${den}`);
            }

            return { html: qHtml, ans: answer, steps, hint };
        },

        logs: () => {
            const type = rnd(1, 3);
            let qHtml, answer, steps = [];

            if (type === 1) { 
                const base = rnd(2, 5);
                const ans = rnd(2, 5);
                const val = Math.pow(base, ans);
                
                qHtml = `Find: log<sub>${base}</sub> ${val}`;
                answer = ans;
                
                steps.push(`Ask: ${base} to what power equals ${val}?`);
                steps.push(`${base}<sup>x</sup> = ${val}`);
                steps.push(`${base}<sup>${ans}</sup> = ${val}`);
                steps.push(`Therefore, x = ${ans}`);
            } else if (type === 2) { 
                const k = rnd(1, 3);
                const total = Math.pow(10, k);
                let f1 = 2;
                if (total === 100) f1 = rndItem([2, 4, 5, 20, 25, 50]);
                if (total === 1000) f1 = rndItem([2, 4, 5, 8, 125, 200, 250, 500]);
                let f2 = total / f1;

                qHtml = `Simplify: log ${f1} + log ${f2}`;
                answer = k;

                steps.push(`Log Rule: log(a) + log(b) = log(a × b)`);
                steps.push(`log(${f1} × ${f2}) = log(${total})`);
                steps.push(`Since base is 10, log(${Math.pow(10, k)}) = ${k}`);
            } else { 
               const baseLog = rndItem([2, 3, 5]);
               const b = rnd(2, 5);
               const exp = rnd(2, 4);
               const x = Math.pow(b, exp);
               qHtml = `Solve for x: log<sub>${b}</sub>(x) = ${exp}`;
               answer = x;
               steps.push(`Convert from logarithmic to exponential form`);
               steps.push(`x = ${b}<sup>${exp}</sup>`);
               steps.push(`x = ${x}`);
            }

            return { html: qHtml, ans: answer, steps, hint: "Enter a number" };
        },

        linear: () => {
            // FIXED: Added missing 'steps' array declaration
            let steps = [];
            const x = rnd(-10, 10);
            const a = rnd(2, 9) * (Math.random() > 0.5 ? 1 : -1);
            const b = rnd(1, 20) * (Math.random() > 0.5 ? 1 : -1);
            const c = (a * x) + b;

            let op = b < 0 ? '-' : '+';
            let dispB = Math.abs(b);

            const qHtml = `Solve for x: ${a}x ${op} ${dispB} = ${c}`;
            const answer = x;
            
            steps.push(`Move constant to right side: ${a}x = ${c} ${b < 0 ? '+' : '-'} ${dispB}`);
            steps.push(`${a}x = ${c - b}`);
            steps.push(`Divide by coefficient ${a}: x = ${(c - b)} / ${a}`);
            steps.push(`x = ${x}`);

            return { html: qHtml, ans: answer, steps, hint: "Enter value of x" };
        },

        quadratic: () => {
            // FIXED: Added missing 'steps' array declaration
            let steps = [];
            let r1 = rnd(-6, 6);
            let r2 = rnd(-6, 6);
            if (r1 === 0) r1 = 1;
            
            const b = -(r1 + r2);
            const c = r1 * r2;

            let bStr = b === 0 ? '' : (b < 0 ? `- ${Math.abs(b)}x` : `+ ${b}x`);
            let cStr = c === 0 ? '' : (c < 0 ? `- ${Math.abs(c)}` : `+ ${c}`);
            
            if (bStr === '' && cStr === '') cStr = "+ 0"; 

            const qHtml = `Solve: x<sup>2</sup> ${bStr} ${cStr} = 0`;
            
            const roots = [r1, r2].sort((a,b) => a - b);
            const answer = roots.join(", "); 
            
            steps.push(`Quadratic Formula: x = [-b ± √(b² - 4ac)] / 2a`);
            steps.push(`a=1, b=${b}, c=${c}`);
            steps.push(`Discriminant (D) = b² - 4ac = (${b})² - 4(1)(${c}) = ${b*b - 4*c}`);
            steps.push(`√D = ${Math.sqrt(b*b - 4*c)}`);
            steps.push(`x = [${-b} ± ${Math.sqrt(b*b - 4*c)}] / 2`);
            steps.push(`Roots: ${roots.join(', ')}`);

            return { html: qHtml, ans: answer, steps, hint: "Enter roots separated by comma (e.g., -2, 4)" };
        }
    };

    // --- Core Logic ---

    function generateQuestion() {
        els.solutionBox.style.display = 'none';
        els.input.value = '';
        els.checkBtn.disabled = false;
        els.checkBtn.style.display = 'block';
        els.gameArea.classList.remove('hidden');
        els.solutionBox.classList.remove('status-correct', 'status-wrong');
        
        currentTopic = els.topic.value;
        const gen = generators[currentTopic];
        
        // Safety try-catch to log errors if any other generator fails
        try {
            currentQuestion = gen();
            els.question.innerHTML = currentQuestion.html;
            els.hint.innerText = currentQuestion.hint;
            setTimeout(() => els.input.focus(), 100);
        } catch (e) {
            console.error("Generator Error:", e);
            els.question.innerText = "Error generating question. Please check console.";
        }
    }

    function checkAnswer() {
        const rawInput = els.input.value.trim().toLowerCase();
        
        if (!rawInput) return;

        let isCorrect = false;
        const expected = String(currentQuestion.ans).toLowerCase();

        if (currentTopic === 'quadratic') {
            let userRoots = rawInput.split(',').map(s => parseFloat(s.trim())).sort((a,b) => a - b);
            let expRoots = expected.split(',').map(s => parseFloat(s.trim()));
            
            if (userRoots.length === expRoots.length && 
                userRoots.every((val, index) => Math.abs(val - expRoots[index]) < 0.01)) {
                isCorrect = true;
            }
        } 
        else if (currentTopic === 'surds') {
            if (rawInput.replace(/\s/g, '') === expected.replace(/\s/g, '')) isCorrect = true;
        } 
        else {
            if (Math.abs(parseFloat(rawInput) - parseFloat(expected)) < 0.01 || rawInput === expected) {
                isCorrect = true;
            }
        }

        total++;
        if (isCorrect) score++;
        updateScore();

        showSolution(isCorrect);
    }

    function showSolution(isCorrect) {
        els.checkBtn.style.display = 'none'; 
        els.solutionBox.style.display = 'block';
        
        els.status.innerText = isCorrect ? "Correct!" : `Incorrect. Answer: ${currentQuestion.ans}`;
        els.solutionBox.className = 'solution-area ' + (isCorrect ? 'status-correct' : 'status-wrong');

        if(currentQuestion.steps) {
            els.steps.innerHTML = currentQuestion.steps.map(s => `<div class="step">➤ ${s}</div>`).join('');
        }
    }

    function updateScore() {
        els.score.innerText = score;
        els.total.innerText = total;
    }

    els.topic.addEventListener('change', () => {
        els.gameArea.classList.add('hidden');
        els.solutionBox.style.display = 'none';
    });
    
    els.input.addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            if (els.checkBtn.style.display !== 'none') {
                checkAnswer();
            }
        }
    });

</script>

</body>
</html>
