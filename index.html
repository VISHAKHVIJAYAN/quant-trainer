<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quant Aptitude Trainer</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" integrity="sha384-vKruj+a13UtuH9DvrfFJ2yZNyNnm2KLS7/ZEzLbitBVU0lelMCUOq1JhZkK+ZpLp" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js" integrity="sha384-PwRUT/YqbnEjkZO0zZxPOj2f2aY1s0u0x3oKY651QbaBqoV0yPwJfvqp8bG2v5NL" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --accent-color: #bb86fc;
            --success-color: #03dac6;
            --error-color: #cf6679;
            --border-radius: 8px;
        }
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(to bottom, #121212, #000);
            color: var(--text-color);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            width: 100%;
            max-width: 600px;
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        h1 { margin: 0; font-size: 1.5rem; color: var(--accent-color); }
       
        .score-board {
            font-size: 0.9rem;
            background: #333;
            padding: 5px 10px;
            border-radius: 4px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        select, button, input {
            padding: 10px;
            border-radius: var(--border-radius);
            border: 1px solid #444;
            background: #2c2c2c;
            color: white;
            font-size: 1rem;
        }
        select { flex: 1 1 150px; cursor: pointer; }
       
        button {
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s, transform 0.1s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        button:hover { transform: translateY(-2px); }
        .btn-primary { background-color: var(--accent-color); color: black; border: none; }
        .btn-primary:hover { opacity: 0.9; }
       
        .btn-check { background-color: var(--success-color); color: black; border: none; width: 100%; margin-top: 10px;}
       
        .btn-next { width: 100%; margin-top: 15px; }
        .question-area {
            text-align: center;
            margin: 30px 0;
            font-size: 1.5rem;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: row;
            flex-wrap: wrap;
            gap: 8px;
        }
        .input-group { margin-bottom: 20px; }
       
        input[type="text"] {
            width: 100%;
            box-sizing: border-box;
            text-align: center;
            font-size: 1.2rem;
        }
        .hint {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
            text-align: center;
            display: block;
        }
        .solution-area {
            background: #252526;
            padding: 15px;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--accent-color);
            margin-top: 20px;
            display: none;
        }
        .solution-title {
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
            color: var(--accent-color);
        }
        .step { margin-bottom: 5px; font-family: monospace; }
        .status-correct { border-left-color: var(--success-color); }
        .status-wrong { border-left-color: var(--error-color); }
        .hidden { display: none; }
        .animate-correct {
            animation: glow-correct 1s ease-in-out;
        }
        .animate-wrong {
            animation: glow-wrong 1s ease-in-out;
        }
        @keyframes glow-correct {
            0% { box-shadow: 0 0 15px var(--success-color); }
            100% { box-shadow: 0 0 0; }
        }
        @keyframes glow-wrong {
            0% { box-shadow: 0 0 15px var(--error-color); }
            100% { box-shadow: 0 0 0; }
        }
        /* Mobile adjustments */
        @media (max-width: 480px) {
            .controls {
                flex-direction: column;
            }
            button, select {
                width: 100%;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>Quant Trainer</h1>
        <div class="score-board">Score: <span id="score">0</span> / <span id="total">0</span></div>
    </header>
    <div class="controls">
        <select id="topicSelect" aria-label="Select Math Topic">
            <option value="indices">Indices (Exponents)</option>
            <option value="surds">Surds (Roots)</option>
            <option value="logs">Logarithms</option>
            <option value="linear">Linear Equations</option>
            <option value="quadratic">Quadratic Equations</option>
        </select>
        <select id="difficultySelect" aria-label="Select Difficulty">
            <option value="easy">Easy</option>
            <option value="medium">Medium</option>
            <option value="hard">Hard</option>
        </select>
        <button class="btn-primary" onclick="generateQuestion()" id="genBtn">New Question</button>
    </div>
    <div id="gameArea" class="hidden">
        <div class="question-area" id="questionText"></div>
        <div class="input-group">
            <input type="text" id="userAnswer" placeholder="Enter answer..." autocomplete="off">
            <span class="hint" id="inputHint"></span>
        </div>
        <button class="btn-check" onclick="checkAnswer()" id="checkBtn">Check Answer</button>
    </div>
    <div class="solution-area" id="solutionBox">
        <span class="solution-title" id="solutionStatus">Solution</span>
        <div id="timeTaken"></div>
        <div id="steps"></div>
        <button class="btn-primary btn-next" onclick="generateQuestion()">Next Question</button>
    </div>
</div>
<script>
    // State
    let currentTopic = '';
    let currentDifficulty = 'easy';
    let currentQuestion = {};
    let score = 0;
    let total = 0;
    let startTime = 0;
    // DOM Elements
    const els = {
        topic: document.getElementById('topicSelect'),
        difficulty: document.getElementById('difficultySelect'),
        question: document.getElementById('questionText'),
        input: document.getElementById('userAnswer'),
        hint: document.getElementById('inputHint'),
        gameArea: document.getElementById('gameArea'),
        solutionBox: document.getElementById('solutionBox'),
        status: document.getElementById('solutionStatus'),
        timeTaken: document.getElementById('timeTaken'),
        steps: document.getElementById('steps'),
        score: document.getElementById('score'),
        total: document.getElementById('total'),
        checkBtn: document.getElementById('checkBtn'),
        genBtn: document.getElementById('genBtn')
    };
    // Math Utils
    const rnd = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const rndItem = (arr) => arr[Math.floor(Math.random() * arr.length)];
    const gcd = (a, b) => (!b) ? a : gcd(b, a % b);
    // Adjust ranges based on difficulty
    function getRange(diff, easyMin, easyMax, medFactor = 2, hardFactor = 3) {
        if (diff === 'medium') return [easyMin * medFactor, easyMax * medFactor];
        if (diff === 'hard') return [easyMin * hardFactor, easyMax * hardFactor];
        return [easyMin, easyMax];
    }
    // --- Generators ---
    const generators = {
        indices: (diff) => {
            const type = rnd(1, 2);
            let qHtml, answer, steps = [];
            const [baseMin, baseMax] = getRange(diff, 2, 5);
            const [expMin, expMax] = getRange(diff, 2, 6);
            const base = rnd(baseMin, baseMax);
            if (type === 1) {
                const e1 = rnd(expMin, expMax);
                const e2 = rnd(expMin, expMax);
                const e3 = rnd(1, e1 + e2 - 1);
                qHtml = `\[ ${base}^{${e1}} \\times ${base}^{${e2}} \\div ${base}^{${e3}} \]`;
                const finalExp = e1 + e2 - e3;
                answer = Math.pow(base, finalExp);
                steps.push(`Apply laws of indices: \\( a^{m} \\times a^{n} = a^{m+n} \\)`);
                steps.push(`\\( ${base}^{${e1}+${e2}} \\div ${base}^{${e3}} = ${base}^{${e1+e2}} \\div ${base}^{${e3}} \\)`);
                steps.push(`Apply division law: \\( a^{m} \\div a^{n} = a^{m-n} \\)`);
                steps.push(`\\( ${base}^{${e1+e2}-${e3}} = ${base}^{${finalExp}} \\)`);
                steps.push(`Calculate: \\( ${base}^{${finalExp}} = ${answer} \\)`);
            } else {
                const e1 = rnd(expMin, expMax);
                const e2 = rnd(expMin, expMax);
                qHtml = `\[ (${base}^{${e1}})^{${e2}} \]`;
                const finalExp = e1 * e2;
                answer = Math.pow(base, finalExp);
                steps.push(`Apply power rule: \\( (a^{m})^{n} = a^{m \\times n} \\)`);
                steps.push(`\\( ${base}^{${e1} \\times ${e2}} = ${base}^{${finalExp}} \\)`);
                steps.push(`Calculate: \\( ${answer} \\)`);
            }
            return { html: qHtml, ans: answer, steps, hint: "Enter an integer" };
        },
        surds: (diff) => {
            const type = rnd(1, 2);
            let qHtml, answer, steps = [];
            let hint = "Format: '3root2' for 3√2";
            const [sqMin, sqMax] = getRange(diff, 4, 64, 2, 4);
            const square = [4, 9, 16, 25, 36, 49, 64].map(x => x * (diff === 'easy' ? 1 : diff === 'medium' ? 2 : 4));
            if (type === 1) {
                const sq = rndItem(square);
                const rem = rndItem([2, 3, 5, 6, 7]);
                const num = sq * rem;
                const rootSq = Math.sqrt(sq);
                qHtml = `Simplify: \[ \\sqrt{${num}} \]`;
                answer = `${rootSq}root${rem}`;
                if (rootSq === 1) answer = `root${rem}`;
                steps.push(`Factorize ${num} into a square number and a remainder`);
                steps.push(`\\( \\sqrt{${num}} = \\sqrt{${sq} \\times ${rem}} \\)`);
                steps.push(`Separately root the square: \\( \\sqrt{${sq}} = ${rootSq} \\)`);
                steps.push(`\\( ${rootSq} \\sqrt{${rem}} \\)`);
            } else {
                const den = rndItem([2, 3, 5, 6, 7]);
                const num = den * rnd(1, diff === 'easy' ? 5 : diff === 'medium' ? 10 : 20);
                const factor = num / den;
                qHtml = `Rationalize: \[ \\frac{${num}}{\\sqrt{${den}}} \]`;
                answer = (factor === 1) ? `root${den}` : `${factor}root${den}`;
                steps.push(`Multiply numerator and denominator by \\( \\sqrt{${den}} \\)`);
                steps.push(`\\( \\frac{${num} \\times \\sqrt{${den}}}{ \\sqrt{${den}} \\times \\sqrt{${den}} } \\)`);
                steps.push(`\\( ${num} \\sqrt{${den}} / ${den} \\)`);
                steps.push(`Simplify fraction ${num}/${den} = ${factor}`);
                steps.push(`Result: ${factor === 1 ? '' : factor} \\( \\sqrt{${den}} \\)`);
            }
            return { html: qHtml, ans: answer, steps, hint };
        },
        logs: (diff) => {
            const type = rnd(1, 3);
            let qHtml, answer, steps = [];
            const [baseMin, baseMax] = getRange(diff, 2, 5);
            const [ansMin, ansMax] = getRange(diff, 2, 5);
            if (type === 1) {
                const base = rnd(baseMin, baseMax);
                const ans = rnd(ansMin, ansMax);
                const val = Math.pow(base, ans);
                qHtml = `Find: \[ \\log_{${base}} ${val} \]`;
                answer = ans;
                steps.push(`Ask: ${base} to what power equals ${val}?`);
                steps.push(`\\( ${base}^{x} = ${val} \\)`);
                steps.push(`\\( ${base}^{${ans}} = ${val} \\)`);
                steps.push(`Therefore, x = ${ans}`);
            } else if (type === 2) {
                const k = rnd(1, diff === 'easy' ? 3 : diff === 'medium' ? 5 : 7);
                const total = Math.pow(10, k);
                let f1 = rnd(2, total / 2);
                let f2 = total / f1;
                qHtml = `Simplify: \[ \\log ${f1} + \\log ${f2} \]`;
                answer = k;
                steps.push(`Log Rule: \\( \\log(a) + \\log(b) = \\log(a \\times b) \\)`);
                steps.push(`\\( \\log(${f1} \\times ${f2}) = \\log(${total}) \\)`);
                steps.push(`Since base is 10, \\( \\log(${Math.pow(10, k)}) = ${k} \\)`);
            } else {
                const b = rnd(baseMin, baseMax);
                const exp = rnd(ansMin, ansMax);
                const x = Math.pow(b, exp);
                qHtml = `Solve for x: \[ \\log_{${b}}(x) = ${exp} \]`;
                answer = x;
                steps.push(`Convert from logarithmic to exponential form`);
                steps.push(`\\( x = ${b}^{${exp}} \\)`);
                steps.push(`x = ${x}`);
            }
            return { html: qHtml, ans: answer, steps, hint: "Enter a number" };
        },
        linear: (diff) => {
            let steps = [];
            const [xMin, xMax] = getRange(diff, -10, 10, 1.5, 2);
            const [aMin, aMax] = getRange(diff, 2, 9);
            const [bMin, bMax] = getRange(diff, 1, 20);
            const x = rnd(xMin, xMax);
            const a = rnd(aMin, aMax) * (Math.random() > 0.5 ? 1 : -1);
            const b = rnd(bMin, bMax) * (Math.random() > 0.5 ? 1 : -1);
            const c = (a * x) + b;
            const op = b < 0 ? '-' : '+';
            const dispB = Math.abs(b);
            qHtml = `Solve for x: \[ ${a}x ${op} ${dispB} = ${c} \]`;
            const answer = x;
            steps.push(`Move constant to right side: \\( ${a}x = ${c} ${b < 0 ? '+' : '-'} ${dispB} \\)`);
            steps.push(`\\( ${a}x = ${c - b} \\)`);
            steps.push(`Divide by coefficient ${a}: x = \\( \\frac{${c - b}}{${a}} \\)`);
            steps.push(`x = ${x}`);
            return { html: qHtml, ans: answer, steps, hint: "Enter value of x" };
        },
        quadratic: (diff) => {
            let steps = [];
            const [rMin, rMax] = getRange(diff, -6, 6, 1.5, 2);
            let r1 = rnd(rMin, rMax);
            let r2 = rnd(rMin, rMax);
            if (r1 === 0) r1 = 1;
            const b = -(r1 + r2);
            const c = r1 * r2;
            const bSign = b > 0 ? '+' : '-';
            const cSign = c > 0 ? '+' : '-';
            const bTerm = b === 0 ? '' : ` ${bSign} ${Math.abs(b)}x`;
            const cTerm = c === 0 ? '' : ` ${cSign} ${Math.abs(c)}`;
            qHtml = `Solve: \[ x^{2}${bTerm}${cTerm} = 0 \]`;
            const roots = [r1, r2].sort((a,b) => a - b);
            const answer = roots.join(", ");
            steps.push(`Quadratic Formula: \\( x = \\frac{[-b \\pm \\sqrt{(b^2 - 4ac)}]}{2a} \\)`);
            steps.push(`a=1, b=${b}, c=${c}`);
            steps.push(`Discriminant (D) = \\( b^2 - 4ac = (${b})^2 - 4(1)(${c}) = ${b*b - 4*c} \\)`);
            steps.push(`\\( \\sqrt{D} = ${Math.sqrt(b*b - 4*c)} \\)`);
            steps.push(`x = \\( [${-b} \\pm ${Math.sqrt(b*b - 4*c)}] / 2 \\)`);
            steps.push(`Roots: ${roots.join(', ')}`);
            return { html: qHtml, ans: answer, steps, hint: "Enter roots separated by comma (e.g., -2, 4)" };
        }
    };
    // --- Core Logic ---
    function generateQuestion() {
        els.solutionBox.style.display = 'none';
        els.input.value = '';
        els.checkBtn.disabled = false;
        els.checkBtn.style.display = 'block';
        els.gameArea.classList.remove('hidden');
        els.solutionBox.classList.remove('status-correct', 'status-wrong', 'animate-correct', 'animate-wrong');
       
        currentTopic = els.topic.value;
        currentDifficulty = els.difficulty.value;
        const gen = generators[currentTopic];
       
        try {
            currentQuestion = gen(currentDifficulty);
            els.question.innerHTML = currentQuestion.html;
            renderMathInElement(els.question, {
                delimiters: [
                    {left: "\\[", right: "\\]", display: true},
                    {left: "\\(", right: "\\)", display: false}
                ],
                throwOnError: false
            });
            els.hint.innerText = currentQuestion.hint;
            setTimeout(() => els.input.focus(), 100);
            startTime = Date.now();
        } catch (e) {
            console.error("Generator Error:", e);
            els.question.innerText = "Error generating question. Please check console.";
        }
    }
    function checkAnswer() {
        const rawInput = els.input.value.trim().toLowerCase();
       
        if (!rawInput) return;
        const timeTaken = ((Date.now() - startTime) / 1000).toFixed(1);
        let isCorrect = false;
        const expected = String(currentQuestion.ans).toLowerCase();
        if (currentTopic === 'quadratic') {
            let userRoots = rawInput.split(',').map(s => parseFloat(s.trim())).sort((a,b) => a - b);
            let expRoots = expected.split(',').map(s => parseFloat(s.trim()));
            if (userRoots.length === expRoots.length &&
                userRoots.every((val, index) => Math.abs(val - expRoots[index]) < 0.01)) {
                isCorrect = true;
            }
        }
        else if (currentTopic === 'surds') {
            if (rawInput.replace(/\s/g, '') === expected.replace(/\s/g, '')) isCorrect = true;
        }
        else {
            if (Math.abs(parseFloat(rawInput) - parseFloat(expected)) < 0.01 || rawInput === expected) {
                isCorrect = true;
            }
        }
        total++;
        if (isCorrect) score++;
        updateScore();
        showSolution(isCorrect, timeTaken);
    }
    function showSolution(isCorrect, timeTaken) {
        els.checkBtn.style.display = 'none';
        els.solutionBox.style.display = 'block';
       
        els.status.innerText = isCorrect ? "Correct!" : `Incorrect. Answer: ${currentQuestion.ans}`;
        els.timeTaken.innerText = `Time taken: ${timeTaken} seconds`;
        els.solutionBox.className = 'solution-area ' + (isCorrect ? 'status-correct animate-correct' : 'status-wrong animate-wrong');
        if(currentQuestion.steps) {
            els.steps.innerHTML = currentQuestion.steps.map(s => `<div class="step">➤ <span class="math-step">${s}</span></div>`).join('');
            renderMathInElement(els.steps, {
                delimiters: [
                    {left: "\\[", right: "\\]", display: true},
                    {left: "\\(", right: "\\)", display: false}
                ],
                throwOnError: false
            });
        }
    }
    function updateScore() {
        els.score.innerText = score;
        els.total.innerText = total;
    }
    els.topic.addEventListener('change', () => {
        els.gameArea.classList.add('hidden');
        els.solutionBox.style.display = 'none';
    });
    els.difficulty.addEventListener('change', () => {
        els.gameArea.classList.add('hidden');
        els.solutionBox.style.display = 'none';
    });
   
    els.input.addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            if (els.checkBtn.style.display !== 'none') {
                checkAnswer();
            }
        }
    });
</script>
</body>
</html>
